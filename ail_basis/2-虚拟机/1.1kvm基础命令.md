### kvm文件位置
```
/etc/libvirt/qemu #配置文件
/var/lib/libvirt/images/ #磁盘镜像
```

### kvm一键删除虚拟机
```
virsh shutdown vm #关闭虚拟机
virsh destroy vm   #强制断电
virsh undefine vm  #移除配置信息
rm /home/iso/vm.qcow2   #移除磁盘
```

### kvm基本命令

```
sudo virsh edit vm1
virsh list --all //列出所有虚拟机
virsh start vm1     # 虚拟机开启（启动）：
virsh reboot centos7-1    # 虚拟机重新启动
virsh shutdown vm31  # 虚拟机关机
virsh destroy centos7-1   # 强制关机（强制断电）
virsh suspend centos7-1   # 暂停（挂起）KVM 虚拟机
virsh resume centos7-1    # 恢复被挂起的 KVM 虚拟机
virsh undefine centos7-1  # 该方法只删除配置文件，磁盘文件未删除
virsh autostart centos7-1 # 随物理机启动而启动（开机启动）
virsh autostart --disable centos7-1 # 取消标记为自动开始（取消开机启动）
```

### kvm快速克隆容器

```
virt-clone -o vm31 -n vm32 --auto-clone
```
### kvm克隆容器后修改端口
```
sudo virsh edit vm32
type=vnc  autoport= no 修改端口和autoport
virsh start vm32
vnc://192.168.8.16:5990
```

### 修改虚拟机配置文件
vim /etc/libvirt/qemu/vm3.xml 
```
虚拟机名称：<name>vm2</name>
uuid：<uuid>d0bc50b6-6acc-432b-9953-bc47b2b4aa87</uuid>
磁盘镜像文件名称：<source file='/var/lib/libvirt/images/vm2.qcow2'/>
mac地址：<mac address='52:54:00:04:63:6a'/>
sudo virsh edit vm1 
```

### 快照管理
```
virsh snapshot-create-as sriov-1 sriov-1-s1  //为虚拟机sriov-1创建快照sriov-1-s1
virsh snapshot-list sriov-1 //列出虚拟机test1的所有快照
virsh snapshot-info sriov-1 sriov-1-s1 //查看快照的详细信息
virsh snapshot-delete sriov-1sriov-1-s1 //删除虚拟机sriov-1的快照sriov-1-s1
virsh snapshot-revert centos7-5 centos7-5-s1 #恢复快照
```

### 扩容
```
qemu-img resize /home/iso/vm2.qcow2 100G
```
```
df -h  #查看结果
lsblk
```

进入容器扩展分区
```
sudo apt update
sudo apt install cloud-guest-utils
sudo growpart /dev/vda 3
sudo resize2fs /dev/vda3
```
验证扩展
```
df -h
```

### 其他说明
```
raw 原始格式，性能最好。直接分配指定的空间。raw不支持快照
qcow2 性能上还是不如raw，qcow2支持快照。用多少空间分配多少空间。
默认安装好的用的是raw格式，做快照要把他转换成qcow2格式
qemu-img convert -f raw -O qcow2 /var/lib/libvirt/images/rhel5u8-1.img /var/lib/libvirt/images/rhel5u8-1_qcow2.img
建立qcow2格式磁盘文件:qemu-img create -f qcow2 test.qcow2 20G            -f指定格式
建立raw格式磁盘文件:  qemu-img create -f raw test.raw 20G       大小20G
查看已经创建的虚拟磁盘文件:  qemu-img info test.qcow2
```


