### 容器中添加gpu
```
docker run --gpus 'all,capabilities=utility' --rm ubuntu mycontainer
```


### ubuntu安装 NVIDIA 驱动
```
https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html #官网教程
sudo ubuntu-drivers autoinstall
sudo reboot
nvidia-smi
```

### centos安装 NVIDIA 驱动
```
sudo yum install epel-release
sudo yum install https://www.elrepo.org/elrepo-release-7.el7.elrepo.noarch.rpm
sudo yum --enablerepo=elrepo-kernel install kmod-nvidia
sudo reboot
nvidia-smi
```


### 宿主机执行安装nvidia-container-toolkit
配置生产存储库：ubuntu(先开启代理)
```
curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
  && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
    sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
```
配置生产存储库：centos(先开启代理)
```
curl -s -L https://nvidia.github.io/libnvidia-container/stable/rpm/nvidia-container-toolkit.repo | \
sudo tee /etc/yum.repos.d/nvidia-container-toolkit.repo
```

 
可选，配置存储库以使用实验软件包：ubuntu

```
sed -i -e '/experimental/ s/^#//g' /etc/apt/sources.list.d/nvidia-container-toolkit.list
```
可选，配置存储库以使用实验软件包：centos
```
sudo yum-config-manager --enable nvidia-container-toolkit-experimental
```


安装NVIDIA容器工具包：ubuntu
```
sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit
```

安装NVIDIA容器工具包：centos
```
sudo yum install -y nvidia-container-toolkit
```

### 修改Docker配置文件
使用nvidia-ctk命令配置容器运行时（nvidia-ctk命令修改主机上的/etc/docker/daemon.json文件。文件已更新，以便Docker可以使用NVIDIA容器运行时。）
```
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker #重启Docker守护进程
```