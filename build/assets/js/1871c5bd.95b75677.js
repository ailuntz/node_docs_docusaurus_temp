"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9702],{1184:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var r=s(4848),c=s(8453);const i={},t=void 0,d={id:"\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u8282\u70b9",title:"1.2k8s\u7cfb\u7edf\u5b89\u88c5\u8282\u70b9",description:"\u5173\u95edswap\u5206\u533a",source:"@site/ail_basis/3-\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u8282\u70b9.md",sourceDirName:"3-\u96c6\u7fa4",slug:"/\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u8282\u70b9",permalink:"/node_docs_docusaurus_temp/ailbasis/\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u8282\u70b9",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/ail_basis/3-\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u8282\u70b9.md",tags:[],version:"current",lastUpdatedBy:"\u201cAiluntz\u201d",lastUpdatedAt:1727340015e3,frontMatter:{},sidebar:"ailbasis",previous:{title:"1.2k8s\u7cfb\u7edf\u5b89\u88c5\u57fa\u7840",permalink:"/node_docs_docusaurus_temp/ailbasis/\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u57fa\u7840"},next:{title:"1.2k8s\u7cfb\u7edf\u5b89\u88c5\u9644\u5f55",permalink:"/node_docs_docusaurus_temp/ailbasis/\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u9644\u5f55"}},o={},l=[{value:"\u5173\u95edswap\u5206\u533a",id:"\u5173\u95edswap\u5206\u533a",level:3},{value:"\u67e5\u770b\u8282\u70b9",id:"\u67e5\u770b\u8282\u70b9",level:3},{value:"\u67e5\u770b\u6548\u679c",id:"\u67e5\u770b\u6548\u679c",level:3}];function a(e){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"\u5173\u95edswap\u5206\u533a",children:"\u5173\u95edswap\u5206\u533a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sudo swapoff -a\n"})}),"\n",(0,r.jsx)(n.p,{children:"k8s \u96c6\u7fa4\u521d\u59cb\u5316\uff08\u4e3b\u8282\u70b9\u6267\u884c\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubeadm init --apiserver-advertise-address=10.211.55.15 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version=v1.21.14 --service-cidr=10.96.0.0/16 --pod-network-cidr=10.244.0.0/16\n"})}),"\n",(0,r.jsx)(n.p,{children:"k8s \u96c6\u7fa4\u521d\u59cb\u5316\uff08\u4e3b\u8282\u70b9\u6267\u884c/\u6709\u56fa\u5b9aip\u7684\u60c5\u51b5\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'vim /etc/kubeadm-config.yaml\napiVersion: kubeadm.k8s.io/v1beta2\nkind: ClusterConfiguration\nkubernetesVersion: v1.21.14\nimageRepository: registry.aliyuncs.com/google_containers\ncontrolPlaneEndpoint: "180.184.170.35:6443"\nnetworking:\n  serviceSubnet: "10.96.0.0/12"\n  podSubnet: "10.244.0.0/16"\napiServer:\n  certSANs:\n  - "180.184.170.35"\n  - "180.184.170.36\u201d\n'})}),"\n",(0,r.jsx)(n.p,{children:"k8s \u96c6\u7fa4\u521d\u59cb\u5316\uff08\u4e3b\u8282\u70b9\u6267\u884c/\u6709\u56fa\u5b9aip\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubeadm init --config=/etc/kubeadm-config.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6709\u9519\u8bef\u8981\u518d\u6b21\u521d\u59cb\u5316\u8981\u6e05\u9664"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"rm -f /etc/kubernetes/manifests/*.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u521d\u59cb\u5316\u5b8c\u6210\u540e\u64cd\u4f5c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8bb0\u5f55\u6253\u5370\u4fe1\u606f\uff08\u5b50\u8282\u70b9\u7528\uff09"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubeadm join 10.211.55.15:6443 --token l1h7vz.nl5h1rqzufxcrw9s --discovery-token-ca-cert-hash sha256:c0e5d35f91d40407a0e5d64bb51ef5b4c36c8546a64ebe228cc5362d244d3dc7\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5b89\u88c5Kubernetes\u7f51\u7edc\u63d2\u4ef6 \u5c06\u771f\u5b9eIP\u5199\u5165master\u7684hosts\u6587\u4ef6\n\u7531\u4e8e\u65e0\u6cd5\u8bbf\u95ee\u5230\u5916\u7f51\uff0c\u901a\u8fc7\u5728 ",(0,r.jsx)(n.a,{href:"https://www.ipaddress.com/",children:"https://www.ipaddress.com/"})," \u67e5\u8be2raw.githubusercontent.com\u7684\u771f\u5b9eIP\uff0c\u5e76\u5199\u5165hosts\u6587\u4ef6"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"vim /etc/hosts\n185.199.108.133 raw.githubusercontent.com\n185.199.109.133 raw.githubusercontent.com\n185.199.110.133 raw.githubusercontent.com\n185.199.111.133 raw.githubusercontent.com\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4fee\u6539docker\u6e90"}),"\n",(0,r.jsx)(n.p,{children:"\u4e3b\u8282\u70b9\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\n\u5b89\u88c5\u65b9\u6cd51\u547d\u4ee4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl apply -f https://projectcalico.docs.tigera.io/v3.19/manifests/calico.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b89\u88c5\u65b9\u6cd52\u547d\u4ee4/\u5f03\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b50\u8282\u70b9\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker pull docker.io/calico/cni:v3.19.4\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b50\u8282\u70b9\u91cd\u542f\u670d\u52a1/\u4e3b\u8282\u70b9\u4e5f\u91cd\u542f\u670d\u52a1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"systemctl daemon-reload\nsystemctl restart docker\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u67e5\u770b\u8282\u70b9",children:"\u67e5\u770b\u8282\u70b9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl get nodes\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728Kubernetes\u96c6\u7fa4\u4e2d\u521b\u5efa\u4e00\u4e2apod\uff0c\u9a8c\u8bc1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\n\u5728master\u90e8\u7f72nginx"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl create deployment nginx --image=nginx:alpine\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7NodePort\u7684\u65b9\u5f0f\u66b4\u9732\u7aef\u53e3\u53f7"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl expose deployment nginx --port=80 --type=NodePort\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u67e5\u770b\u6548\u679c",children:"\u67e5\u770b\u6548\u679c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl describe svc nginx-app\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7node1\u7684ip\u5730\u5740\u8bbf\u95eenginx"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"http://10.211.55.17:31746\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6269\u5bb92\u4e2a\u526f\u672c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl scale deployment nginx --replicas=2\nkubectl get pods\n"})})]})}function p(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>d});var r=s(6540);const c={},i=r.createContext(c);function t(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);