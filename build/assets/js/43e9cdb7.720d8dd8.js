"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6226],{4160:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var s=i(4848),d=i(8453);const r={},o=void 0,c={id:"\u865a\u62df\u673a/1.1kvm\u7cfb\u7edf\u5b89\u88c5",title:"1.1kvm\u7cfb\u7edf\u5b89\u88c5",description:"\u7981\u7528 CD-ROM \u4ed3\u5e93(\u5982\u679cubuntu\u7cfb\u7edf\u5b89\u88c5\u5230\u65f6\u5019\u672a\u81ea\u9009\u6e90)",source:"@site/ail_basis/2-\u865a\u62df\u673a/1.1kvm\u7cfb\u7edf\u5b89\u88c5.md",sourceDirName:"2-\u865a\u62df\u673a",slug:"/\u865a\u62df\u673a/1.1kvm\u7cfb\u7edf\u5b89\u88c5",permalink:"/node_docs_docusaurus_temp/ailbasis/\u865a\u62df\u673a/1.1kvm\u7cfb\u7edf\u5b89\u88c5",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/ail_basis/2-\u865a\u62df\u673a/1.1kvm\u7cfb\u7edf\u5b89\u88c5.md",tags:[],version:"current",lastUpdatedBy:"\u201cAiluntz\u201d",lastUpdatedAt:1727340015e3,frontMatter:{},sidebar:"ailbasis",previous:{title:"1.1kvm\u57fa\u7840\u547d\u4ee4",permalink:"/node_docs_docusaurus_temp/ailbasis/\u865a\u62df\u673a/1.1kvm\u57fa\u7840\u547d\u4ee4"},next:{title:"1.2k8s\u7cfb\u7edf\u5b89\u88c5\u57fa\u7840",permalink:"/node_docs_docusaurus_temp/ailbasis/\u96c6\u7fa4/1.2k8s\u7cfb\u7edf\u5b89\u88c5\u57fa\u7840"}},t={},l=[{value:"\u7981\u7528 CD-ROM \u4ed3\u5e93(\u5982\u679cubuntu\u7cfb\u7edf\u5b89\u88c5\u5230\u65f6\u5019\u672a\u81ea\u9009\u6e90)",id:"\u7981\u7528-cd-rom-\u4ed3\u5e93\u5982\u679cubuntu\u7cfb\u7edf\u5b89\u88c5\u5230\u65f6\u5019\u672a\u81ea\u9009\u6e90",level:3},{value:"\u521b\u5efa\u7f51\u6865 br0 \u548c enp2s0 \u7684\u914d\u7f6e\u6587\u4ef6",id:"\u521b\u5efa\u7f51\u6865-br0-\u548c-enp2s0-\u7684\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u52a0\u8f7d Virtio \u9a71\u52a8\u7a0b\u5e8f",id:"\u52a0\u8f7d-virtio-\u9a71\u52a8\u7a0b\u5e8f",level:3},{value:"\u5b89\u88c5win\u7cfb\u7edf \u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55",id:"\u5b89\u88c5win\u7cfb\u7edf-\u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55",level:3},{value:"\u5b89\u88c5linux\u7cfb\u7edf \u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55",id:"\u5b89\u88c5linux\u7cfb\u7edf-\u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55",level:3},{value:"macOS \u4e0b\uff0c\u2318 + Space \u542f\u52a8 Spotlight\uff0c\u8f93\u5165\uff1a",id:"macos-\u4e0b--space-\u542f\u52a8-spotlight\u8f93\u5165",level:3},{value:"Kvm\u663e\u5361\u76f4\u901a",id:"kvm\u663e\u5361\u76f4\u901a",level:2},{value:"\u7981\u7528\u9ed8\u8ba4\u663e\u5361\u9a71\u52a8nouveau \u9a71\u52a8/\u7f16\u8f91\u786c\u4ef6\u9ed1\u540d\u5355",id:"\u7981\u7528\u9ed8\u8ba4\u663e\u5361\u9a71\u52a8nouveau-\u9a71\u52a8\u7f16\u8f91\u786c\u4ef6\u9ed1\u540d\u5355",level:3},{value:"\u7f16\u8f91 VFIO \u914d\u7f6e\u6587\u4ef6",id:"\u7f16\u8f91-vfio-\u914d\u7f6e\u6587\u4ef6",level:3},{value:"vfio-pci\u624b\u52a8\u89e3\u7ed1\u663e\u5361",id:"vfio-pci\u624b\u52a8\u89e3\u7ed1\u663e\u5361",level:3},{value:"vfio-pci\u624b\u52a8\u7ed1\u5b9a\u663e\u5361",id:"vfio-pci\u624b\u52a8\u7ed1\u5b9a\u663e\u5361",level:3},{value:"virsh \u547d\u4ee4\u89e3\u7ed1\u663e\u5361",id:"virsh-\u547d\u4ee4\u89e3\u7ed1\u663e\u5361",level:3},{value:"virsh \u547d\u4ee4\u7ed1\u5b9a\u663e\u5361",id:"virsh-\u547d\u4ee4\u7ed1\u5b9a\u663e\u5361",level:3},{value:"\u7ed9\u865a\u62df\u673a\u6dfb\u52a0\u65b0\u786c\u4ef6",id:"\u7ed9\u865a\u62df\u673a\u6dfb\u52a0\u65b0\u786c\u4ef6",level:3},{value:"\u6392\u67e5\u547d\u4ee4",id:"\u6392\u67e5\u547d\u4ee4",level:3}];function h(e){const n={code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h3,{id:"\u7981\u7528-cd-rom-\u4ed3\u5e93\u5982\u679cubuntu\u7cfb\u7edf\u5b89\u88c5\u5230\u65f6\u5019\u672a\u81ea\u9009\u6e90",children:"\u7981\u7528 CD-ROM \u4ed3\u5e93(\u5982\u679cubuntu\u7cfb\u7edf\u5b89\u88c5\u5230\u65f6\u5019\u672a\u81ea\u9009\u6e90)"}),"\n",(0,s.jsx)(n.p,{children:"sudo nano /etc/apt/sources.list\ndeb cdrom:[Your Ubuntu Version] /cdrom/\n\u4fee\u590d dpkg \u95ee\u9898\nsudo dpkg --configure -a"}),"\n",(0,s.jsx)(n.h3,{id:"\u521b\u5efa\u7f51\u6865-br0-\u548c-enp2s0-\u7684\u914d\u7f6e\u6587\u4ef6",children:"\u521b\u5efa\u7f51\u6865 br0 \u548c enp2s0 \u7684\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo tee /etc/systemd/network/br0.netdev > /dev/null << EOF\n[NetDev]\nName=br0\nKind=bridge\nEOF\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u521b\u5efa /etc/systemd/network/enp2s0.network \u6765\u914d\u7f6e enp2s0 \u4f5c\u4e3a\u6865\u63a5\u4ece\u5c5e\u8bbe\u5907\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo tee /etc/systemd/network/enp2s0.network > /dev/null << EOF\n[Match]\nName=enp2s0\n[Network]\nBridge=br0\nEOF\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u914d\u7f6e br0 \u4f5c\u4e3a\u5177\u6709\u9759\u6001 IP \u7684\u6865\u63a5\u63a5\u53e3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo tee /etc/systemd/network/br0.network > /dev/null << EOF\n[Match]\nName=br0\n[Network]\nAddress=192.168.8.16/24\nGateway=192.168.8.1\nDNS=8.8.8.8\nDNS=8.8.4.4\nEOF\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u67e5\u770b\u6587\u4ef6\u786e\u4fdd\u914d\u7f6e\u6b63\u786e\u5e76\u51c6\u5907\u5e94\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cat /etc/systemd/network/br0.netdev\ncat /etc/systemd/network/enp2s0.network\ncat /etc/systemd/network/br0.network\n\u786e\u8ba4\u540e\u5e94\u7528\u66f4\u6539\nsudo netplan apply \n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7f16\u8f91\u539f\u59cb\u6587\u4ef6vi /etc/netplan/00-installer-config.yaml\u6216\u8005\u5220\u9664\u6587\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo rm /etc/netplan/*.yaml\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u9010\u6b65\u5e94\u7528\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo systemctl restart systemd-networkd\nsudo networkctl reload\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u9a8c\u8bc1\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"networkctl status br0\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6700\u7ec8\u786e\u8ba4\u5e76\u5e94\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo systemctl restart systemd-networkd\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u542f\u7535\u8111"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"reboot\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u68c0\u67e5\u6865\u63a5\u914d\u7f6e\u662f\u5426\u751f\u6548\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"nmcli device status\nbrctl show\nip addr\nip addr show br0\nip addr show enp2s0\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5b89\u88c5\u8f6f\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo apt update\nsudo apt install -y qemu-kvm libvirt-daemon-system libvirt-clients virtinst\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5f00\u542fkvm\u670d\u52a1\uff0c\u5e76\u4e14\u8bbe\u7f6e\u5176\u5f00\u673a\u81ea\u52a8\u542f\u52a8"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"systemctl start libvirtd\nsystemctl enable libvirtd\nsystemctl status libvirtd\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u786e\u4fdd qemu \u7528\u6237\uff08\u901a\u5e38\u662f qemu \u6216 libvirt-qemu \u7528\u6237\uff09\u5177\u6709\u5bf9 ISO \u6587\u4ef6\u548c\u76ee\u5f55\u7684\u8bfb\u53d6\u6743\u9650\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo chown qemu:qemu /home/iso/19044.3693.231108-0702.21H2_RELEASE_SVC_PROD1_CLIENT_X64FRE_ZH-CN.iso\nsudo chmod 644 /home/iso/19044.3693.231108-0702.21H2_RELEASE_SVC_PROD1_CLIENT_X64FRE_ZH-CN.iso\nsudo chown qemu:qemu /home/iso/virtio-win-0.1.262.iso\nsudo chmod 644 /home/iso/virtio-win-0.1.262.iso\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo chmod o+x /home #\u8c03\u6574\u7236\u76ee\u5f55\u6743\u9650\nsudo chmod o+x /home/iso\nsudo usermod -aG libvirt qemu #\u786e\u4fdd libvirt-qemu \u7528\u6237\u5177\u6709\u9002\u5f53\u7684\u6743\u9650\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u52a0\u8f7d-virtio-\u9a71\u52a8\u7a0b\u5e8f",children:"\u52a0\u8f7d Virtio \u9a71\u52a8\u7a0b\u5e8f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u5728 Windows \u5b89\u88c5\u7a0b\u5e8f\u4e2d\uff0c\u9009\u62e9\u5b89\u88c5\u78c1\u76d8\u65f6\u51fa\u73b0\u201c\u627e\u4e0d\u5230\u9a71\u52a8\u5668\u201d\u6216\u201c\u65e0\u6cd5\u8bc6\u522b\u78c1\u76d8\u201d\u63d0\u793a\u3002\n* \u70b9\u51fb\u201c\u52a0\u8f7d\u9a71\u52a8\u7a0b\u5e8f\u201d\uff08Load driver\uff09\u3002\n* \u70b9\u51fb\u201c\u6d4f\u89c8\u201d\uff08Browse\uff09\uff0c\u7136\u540e\u9009\u62e9 Virtio \u9a71\u52a8\u7a0b\u5e8f ISO \u4e2d\u7684\u6587\u4ef6\u5939\u3002\u9009\u62e9\u5bf9\u5e94\u7684\u9a71\u52a8\u7a0b\u5e8f\u8def\u5f84\uff0c\u901a\u5e38\u662f viostor \u76ee\u5f55\u4e2d\u7684 .inf \u6587\u4ef6\u3002\n\u5728\u5b89\u88c5\u7a0b\u5e8f\u52a0\u8f7d\u4e86 Virtio \u9a71\u52a8\u7a0b\u5e8f\u540e\uff0c\u60a8\u5e94\u8be5\u80fd\u770b\u5230\u865a\u62df\u78c1\u76d8\u3002\u5728\u5217\u8868\u4e2d\u9009\u62e9\u78c1\u76d8\uff0c\u70b9\u51fb\u201c\u4e0b\u4e00\u6b65\u201d\u8fdb\u884c\u5206\u533a\u548c\u683c\u5f0f\u5316\uff0c\u7136\u540e\u7ee7\u7eed\u5b89\u88c5 Windows\u3002\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b89\u88c5win\u7cfb\u7edf-\u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55",children:"\u5b89\u88c5win\u7cfb\u7edf \u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"virt-install \\\n  --virt-type=kvm \\\n  --name=vm31 \\\n  --vcpus=24 \\\n  --memory=16384 \\\n  --cdrom /home/iso/ubuntu-24.04.1-live-server-amd64.iso \\\n  --disk path=/home/iso/vm31.qcow2,size=50,format=qcow2,bus=virtio \\\n  --disk path=/home/iso/virtio-win-0.1.262.iso,device=cdrom,perms=rw \\\n  --network bridge=br0,model=e1000,mac=52:54:00:12:34:68 \\\n  --graphics vnc,port=5990,listen=0.0.0.0,password=782954 \\\n  --os-variant=win10 \\\n  --cpu host-passthrough \\\n  --features kvm_hidden=on \\\n  --force\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b89\u88c5linux\u7cfb\u7edf-\u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55",children:"\u5b89\u88c5linux\u7cfb\u7edf \u6784\u5efa\u65f6\u5373\u5206\u914d\u78c1\u76d8\u76ee\u5f55"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"virt-install \\\n  --virt-type=kvm \\\n  --name=vm31 \\\n  --vcpus=24 \\\n  --memory=16384 \\\n  --cdrom /home/iso/ubuntu-24.04.1-live-server-amd64.iso \\\n  --disk path=/home/iso/vm31.qcow2,size=50,format=qcow2,bus=virtio \\\n  --disk path=/home/iso/virtio-win-0.1.262.iso,device=cdrom,perms=rw \\\n  --network bridge=br0,model=e1000,mac=52:54:00:12:34:68 \\\n  --graphics vnc,port=5990,listen=0.0.0.0,password=782954 \\\n  --os-variant= linux \\\n  --cpu host-passthrough \\\n  --features kvm_hidden=on \\\n  --force\n"})}),"\n",(0,s.jsx)(n.h3,{id:"macos-\u4e0b--space-\u542f\u52a8-spotlight\u8f93\u5165",children:"macOS \u4e0b\uff0c\u2318 + Space \u542f\u52a8 Spotlight\uff0c\u8f93\u5165\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"vnc://192.168.8.16:5990\n"})}),"\n",(0,s.jsx)(n.h2,{id:"kvm\u663e\u5361\u76f4\u901a",children:"Kvm\u663e\u5361\u76f4\u901a"}),"\n",(0,s.jsx)(n.p,{children:"\u68c0\u67e5\u786c\u4ef6\u662f\u5426\u652f\u6301 IOMMU"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"dmesg | grep -e DMAR -e IOMMU\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u914d\u7f6e\u4e86 IOMMU\n\u4fee\u6539\u6587\u4ef6vi /etc/default/grub"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'GRUB_CMDLINE_LINUX_DEFAULT="quiet intel_iommu=on iommu=pt pcie_acs_override=downstream,multifunction video=vesafb:off video=efifb:off ignore_msrs=1 "\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u6784\u5185\u6838\u5e76\u91cd\u542f\u7cfb\u7edf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo grub-mkconfig -o /boot/grub/grub.cfg   #efi\u542f\u52a8\u7684\u7cfb\u7edf//ubuntu\ngrub2-mkconfig -o /boot/grub2/grub.cfg      #bios\u542f\u52a8\u7cfb\u7edf\ngrub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg   #efi\u542f\u52a8\u7684\u7cfb\u7edf\nGRUB_ENABLE_BLSCFG=false  #centos9 \u5e94\u8be5\u628a\u6b64\u53c2\u6570\u6539\u4e3afalse\uff0c\u786e\u4fdd\u91cd\u542f\u6709\u6548\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u7981\u7528\u9ed8\u8ba4\u663e\u5361\u9a71\u52a8nouveau-\u9a71\u52a8\u7f16\u8f91\u786c\u4ef6\u9ed1\u540d\u5355",children:"\u7981\u7528\u9ed8\u8ba4\u663e\u5361\u9a71\u52a8nouveau \u9a71\u52a8/\u7f16\u8f91\u786c\u4ef6\u9ed1\u540d\u5355"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"vim /usr/lib/modprobe.d/dist-blacklist.conf\nvim /etc/modprobe.d/blacklist.conf\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728.conf\u6587\u4ef6\u4e2d\u52a0\u4e0a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"blacklist nouveau\noptions nouveau modeset=0 \nblacklist nvidiafb\nblacklist nvidia\nblacklist snd_hda_intel\nblacklist snd_hda_codec_hdmi\nblacklist i915\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u7f16\u8f91-vfio-\u914d\u7f6e\u6587\u4ef6",children:"\u7f16\u8f91 VFIO \u914d\u7f6e\u6587\u4ef6"}),"\n",(0,s.jsx)(n.p,{children:"\u7f16\u8f91\u5f00\u673a\u542f\u52a8\u6a21\u5757 vi /etc/modules"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u6dfb\u52a0\u4ee5\u4e0b\nvfio\nvfio_iommu_type1\nvfio_pci\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u53e6\u5916\u4fee\u6539vi /etc/modprobe.d/vfio.conf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"#\u7ed1\u5b9a\u8bbe\u5907\noptions vfio-pci ids=10de:2206,10de:1aef\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6dfb\u52a0\u5230\u7cfb\u7edf\u542f\u52a8\u52a0\u8f7d\u6a21\u5757"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"echo 'vfio-pci' > /etc/modules-load.d/vfio-pci.conf\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u6784\u5185\u6838"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo apt install dracut #\u5b89\u88c5dracut\nsudo dracut --force   #\u91cd\u65b0\u751f\u6210 initramfs \nsudo reboot     #\u91cd\u542f\u7cfb\u7edf\n"})}),"\n",(0,s.jsx)(n.h3,{id:"vfio-pci\u624b\u52a8\u89e3\u7ed1\u663e\u5361",children:"vfio-pci\u624b\u52a8\u89e3\u7ed1\u663e\u5361"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"echo 0000:01:00.0 > /sys/bus/pci/devices/0000:01:00.0/driver/unbind\necho 0000:01:00.1 > /sys/bus/pci/devices/0000:01:00.1/driver/unbind\nlspci -nnk -d 10de:  \n"})}),"\n",(0,s.jsx)(n.h3,{id:"vfio-pci\u624b\u52a8\u7ed1\u5b9a\u663e\u5361",children:"vfio-pci\u624b\u52a8\u7ed1\u5b9a\u663e\u5361"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'sudo modprobe vfio-pci  #\u5185\u6838\u52a0\u8f7d\u6a21\u5757\necho "10de 2206" > /sys/bus/pci/drivers/vfio-pci/new_id\necho "10de 1aef" > /sys/bus/pci/drivers/vfio-pci/new_id\necho vfio-pci > /sys/bus/pci/devices/0000:01:00.0/driver_override\necho vfio-pci > /sys/bus/pci/devices/0000:01:00.1/driver_override\necho 0000:01:00.0 > /sys/bus/pci/drivers/vfio-pci/bind\necho 0000:01:00.1 > /sys/bus/pci/drivers/vfio-pci/bind\n'})}),"\n",(0,s.jsx)(n.h3,{id:"virsh-\u547d\u4ee4\u89e3\u7ed1\u663e\u5361",children:"virsh \u547d\u4ee4\u89e3\u7ed1\u663e\u5361"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo virsh nodedev-reattach pci_0000_01_00_0 #\u89e3\u9664\u7ed1\u5b9a GPU\nsudo virsh nodedev-reattach pci_0000_01_00_1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"virsh-\u547d\u4ee4\u7ed1\u5b9a\u663e\u5361",children:"virsh \u547d\u4ee4\u7ed1\u5b9a\u663e\u5361"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"sudo virsh nodedev-detach pci_0000_01_00_0  #\u7ed1\u5b9aGPU\u5230vfio-pci \nsudo virsh nodedev-detach pci_0000_01_00_1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u7ed9\u865a\u62df\u673a\u6dfb\u52a0\u65b0\u786c\u4ef6",children:"\u7ed9\u865a\u62df\u673a\u6dfb\u52a0\u65b0\u786c\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"virsh edit vm12 \n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8bbe\u7f6e\u663e\u5361\uff08domain devices\u5c5e\u6027\u5185\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"<hostdev mode='subsystem' type='pci' managed='yes'>  \n  <source>\n    <address domain='0x0000' bus='0x01' slot='0x00' function='0x0'/>\n  </source>\n</hostdev>\n\n<hostdev mode='subsystem' type='pci' managed='yes'>  \n  <source>\n    <address domain='0x0000' bus='0x01' slot='0x00' function='0x1'/>\n  </source>\n</hostdev>\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8bbe\u7f6ecpu (\u5728domain\u5c5e\u6027\u5185)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"  <cpu mode='host-passthrough' check='none' migratable='on'>\n    <topology sockets='1' cores='24' threads='1'/>\n    <feature policy=\"disable\" name=\"hypervisor\"/>\n  </cpu>\n\n    <feature policy='disable' name='vmx'/> \n    <feature policy='disable' name='svm'/>  \n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6392\u67e5\u547d\u4ee4",children:"\u6392\u67e5\u547d\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"lspci -nnk -d 10de:  #\u663e\u5361\u5f53\u524d\u7ed1\u5b9a\u7684\u9a71\u52a8\nlspci -nn | grep -i nvidia #\u68c0\u6d4b\u663e\u5361\nlsmod | grep nouveau #\u67e5\u770b\u662f\u5426\u52a0\u8f7d\nlsmod | grep vfio   #\u4e00\u5b9a\u8981\u67e5\u770b\u662f\u5426\u52a0\u8f7d//\u5df2\u7ecf\u9759\u6001\u7f16\u8f91\u5230\u5185\u6838\u540e\u6ca1\u6709\u4efb\u4f55\u663e\u793a\ndmesg | grep -i vfio  #\u67e5\u770b\u7ed1\u5b9a\u65e5\u5fd7\nnvidia-smi   #win\u548clinux\u4e0b\u67e5\u770b\u663e\u5361\ncat /proc/cmdline   #\u67e5\u770b\u662f\u5426intel_iommu=on\nfind /sys/kernel/iommu_groups/ -type l   #\u9a8c\u8bc1IOMMU\u9694\u79bb\n"})})]})}function u(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var s=i(6540);const d={},r=s.createContext(d);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);